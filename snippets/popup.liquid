{% comment %} <div id="popup" class="popup hidden">
    <div class="popup-content">
      {% comment %} <span class="popup-close" onclick="closePopup()">&times;</span> {% endcomment %}
      <p id="popup-text"></p>
    </div>
</div> {% endcomment %}

{% comment %} 
    Shows the popup at the specific page or collection. Saves the data in cookie files.
    Cookies are active for 24h.
    
    All we need to change variables that contain resources that we need to show messages on:
    - allowed_pages
    - allowed_collections

    !!! If we need to add new page/collection, u write all of them without spaces between, for instance:
    => allowed_pages = "kitchen-dine,wine"

    Usage:
    {% render 'popup' %}

{% endcomment %}

{% comment %} WORKING {% endcomment %}

{% assign custom_messages = '' %}
{% for block in section.blocks %}
  {% assign custom_messages = custom_messages | append: block.settings.page | append: '|' | append: block.settings.custom_text | append: '|' | append: block.settings.yes_button_text | append: '|' | append: block.settings.yes_button_link | append: '|' | append: block.settings.no_button_text | append: '|' | append: block.settings.no_button_link | append: ',' %}
{% endfor %}

<script>
  window.customMessages = "{{ custom_messages | strip_newlines }}".split(',').reduce((acc, item) => {
    if (item) {
      const parts = item.split('|');
      acc[parts[0].trim()] = {
        text: parts[1],
        yesText: parts[2],
        yesLink: parts[3],
        noText: parts[4],
        noLink: parts[5]
      };
    }
    return acc;
  }, {});

  function showCustomPopup() {
    const currentPage = window.location.pathname.replace(/^\//, '').replace(/\/$/, '');
    if (window.customMessages[currentPage]) {
      const message = window.customMessages[currentPage];
      document.getElementById("popup-text").innerText = message.text;
      document.getElementById("yes-button").innerText = message.yesText;
      document.getElementById("yes-button").setAttribute("onclick", `window.location.href='${message.yesLink}'`);
      document.getElementById("no-button").innerText = message.noText;
      document.getElementById("no-button").setAttribute("onclick", `window.location.href='${message.noLink}'`);
      document.getElementById("custom-popup").classList.remove("hidden");
    }
  }

  document.addEventListener("DOMContentLoaded", showCustomPopup);
</script>

<div id="custom-popup" class="popup hidden">
  <div class="popup-content">
    <p id="popup-text"></p>
    <button id="yes-button" class="yes-button"></button>
    <button id="no-button" class="no-button"></button>
  </div>
</div>

{% comment %} WORKING END{% endcomment %}
